	<!DOCTYPE html>
<html>
    <head>
        <title><%=name%>'s Agent</title>
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/1.2.0/webcomponents-lite.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jdenticon@2.0.0"></script>
		    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
	    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jdenticon@2.0.0"></script>
        
        <!--<link rel="import" href="bower_components/chat-window/chat-window.html">-->
        <style is="custom-style">
            chat-window {
                font-size: small;
                --chat-messages-height: 12em;
                --chat-messages-scroller: {
                    border: 1px inset #eee;
                };
                --paper-input-container-input: {
                    margin: 0 2px;
                };
                --chat-message-text: {
                    background-color: #f0f0f0;
                    padding: 6px 8px;
                    margin: 4px 0;
                    border-radius: 6px;
                };
            }
        </style>
       <style>
        .center {
            margin:auto;
            width: 90%;
        }
        body {
             background: rgb(3,135,142);
             background: linear-gradient(90deg, rgba(3,135,142,1) 2%, rgba(32,130,150,1) 25%, 						   rgba(40,193,85,1) 92%); 
        }
        #messages { list-style-type: none; margin: 0; padding: 0; }
        #messages li { padding: 5px 10px; }
        #messages li:nth-child(odd) { background: #eee; }
        #messages { margin-bottom: 40px }
        
.navbar-light .navbar-brand {
  color: #00FFFF;
  font-size: 25px;
  text-transform: uppercase;
  font-weight: bold;
  letter-spacing: 2px;
}

.navbar-light .navbar-nav .active > .nav-link, .navbar-light .navbar-nav .nav-link.active, .navbar-light .navbar-nav .nav-link.show, .navbar-light .navbar-nav .show > .nav-link {
  color: #000;
}

.navbar-light .navbar-nav .nav-link {
  color: #FF4500;
}

.navbar-toggler {
  background: #00BFFF;
  
}

.navbar-nav {
  text-align: center;
}

.nav-link {
  padding: .2rem 1rem;
}

.nav-link.active,.nav-link:focus{
  color: #00BFFF;
}

.navbar-toggler {
  padding: 1px 5px;
  font-size: 18px;
  line-height: 0.3;
}

.navbar-light .navbar-nav .nav-link:focus, .navbar-light .navbar-nav .nav-link:hover {
  color: #00BFFF;
}

.carousel-item {
  height: 100vh;
  min-height: 300px;
  background: no-repeat center center scroll;
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
}
.carousel-caption {
  bottom: 270px;
}

.carousel-caption h5 {
  font-size: 45px;
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-top: 25px;
}

.carousel-caption p {
  width: 75%;
  margin: auto;
  font-size: 18px;
  line-height: 1.9;
}

    </style>
    </head>
    <body>
        <!-- Header -->
        <!--<header class="w3-container w3-theme w3-padding" id="myHeader">-->
            <!--&lt;!&ndash;<i onclick="w3_open()" class="fa fa-bars w3-xlarge w3-button w3-theme"></i>&ndash;&gt;-->
            <!--<div class="w3-center">-->
                <!---->
            <!--</div>-->
        <!--</header>-->

        <!-- About Modal -->
        <div id="aboutModel" class="w3-modal">
            <div class="w3-modal-content w3-card-4 w3-animate-top">
                <header class="w3-container w3-theme-l1">
        <span onclick="document.getElementById('aboutModel').style.display='none'"
              class="w3-button w3-display-topright">×</span>
                    <h4>SSI Agent</h4>
                </header>
                <div class="w3-padding">
                    <p></p>
                </div>
                <footer class="w3-container w3-theme-l1">
                    <p></p>
                </footer>
            </div>
        </div>

        <!-- Send Credential Modal -->
        <div id="sendCredModel" class="w3-modal">
            <div class="w3-modal-content w3-card-4 w3-animate-top">
                <header class="w3-container w3-theme-l1">
        <span onclick="document.getElementById('sendCredModel').style.display='none'"
              class="w3-button w3-display-topright">×</span>
                    <h4>Credential Builder</h4>
                </header>
                <div class="w3-padding">
                    <p></p>
                </div>
                <footer class="w3-container w3-theme-l1">
                    <p></p>
                </footer>
            </div>
        </div>

        <!-- New Relationship Model -->
        <div id="newRelationshipModel" class="w3-modal">
            <div class="w3-modal-content w3-card-4 w3-animate-top w3-center">
                <header class="w3-container w3-theme-l1">
        <span onclick="document.getElementById('newRelationshipModel').style.display='none'"
              class="w3-button w3-display-topright">×</span>
                    <h4>Create a New Relationship</h4>
                </header>
                <div class="w3-padding">
                    <form class="w3-container w3-card-4 w3-padding" action="/api/send_connection_request" method="POST" target="_self">
                        <div class="w3-section">
                            Recipient's Endpoint DID: <input class="w3-input" type="text" name="did" required>
                        </div>
                        <input class="w3-btn w3-white w3-border" style="display:block;margin:auto;" type="submit" value="Send Connection Request">
                    </form>
                </div>
                <footer class="w3-container w3-theme-l1">
                    <p></p>
                </footer>
            </div>
        </div>

        <!-- New Message Model -->
        <div id="newMessageModel" class="w3-modal">
            <div class="w3-modal-content w3-card-4 w3-animate-top">
                <header class="w3-container w3-theme-l1">
                    <span onclick="document.getElementById('newMessageModel').style.display='none'" class="w3-button w3-display-topright">×</span>
                    <h4>Send a Message</h4>
                </header>
                <div class="w3-padding">
                    <!--The socket message way: onsubmit="sendSovrinMessage('urn:sovrin:agent:message_type:sovrin.org/ui/send_message', this)"-->
                    <form class="w3-container w3-card-4 w3-padding" action="/api/send_message" method="POST" target="_self" >
                        <div class="w3-section">
                            Recipient: <input id="send_message_form_did" class="w3-input" type="text" name="did" value="<%=endpointDid%>">
                        </div>
                        <div class="w3-section">
                            Message: <textarea id="send_message_form_message" class="w3-input" name="message" rows="6" >{
    "type":"SOME_TYPE",
    "message":"test"
}</textarea>
                        </div>
                        <input class="w3-btn w3-white w3-border" style="display:block;margin:auto;" type="submit" value="Send Message">
                    </form>
                </div>
                <footer class="w3-container w3-theme-l1">
                    <p></p>
                </footer>
            </div>
        </div>

        <!--Chat-->
        <script>
            let now = Date.now();
            let messages = [
                { author: 'you', text: 'dummy msg 1', created: now - (60*1000) },
                { author: 'me', text: 'dummy msg 2', created: now - (3*60*1000) },
                { author: 'you', text: 'dummy msg 3', created: now - (10*60*1000) },
                { author: 'you', text: 'dummy msg 4', created: now - (60*60*1000) },
                { author: 'me', text: 'dummy msg 5', created: now - (1.2*60*60*1000) },
                { author: 'me', text: 'dummy msg 6', created: now - (1.5*60*60*1000) },
                { author: 'you', text: 'dummy msg 7', created: now - (11.5*60*60*1000) },
                { author: 'me', text: 'dummy msg 8', created: now - (12*60*60*1000) },
                { author: 'you', text: 'dummy msg 9', created: now - (13*60*60*1000) },
                { author: 'me', text: 'dummy msg 10', created: now - (1.5*24*60*60*1000) },
                { author: 'you', text: 'dummy msg 11', created: now - (1.6*24*60*60*1000) },
                { author: 'me', text: 'dummy msg 12', created: now - (4*24*60*60*1000) },
                { author: 'me', text: 'dummy msg 13', created: now - (4.5*24*60*60*1000) },
                { author: 'you', text: 'dummy msg 14', created: now - (14*24*60*60*1000) },
                { author: 'me', text: 'dummy msg 15', created: now - (14.5*24*60*60*1000) },
            ].reverse();
        </script>

    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
  <ol class="carousel-indicators">
    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
  </ol>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img class="d-block w-100" src="https://i.postimg.cc/YSNswkN5/blockchain-3019120-1280.png" alt="First slide">
      <div class="carousel-caption d-none d-md-block">
      </div>
    </div>
    <div class="carousel-item">
      <img class="d-block w-100" src="https://i.postimg.cc/xTrpqcsw/web-4861605-1280.jpg" alt="Second slide">
      <div class="carousel-caption d-none d-md-block">
      </div>
    </div>
    <div class="carousel-item">
      <img class="d-block w-100" src="https://i.postimg.cc/JzrqBJj2/1-D0n-NIJF0-Fs-Qeg24-VNStct-Q.jpg" alt="Third slide">
      <div class="carousel-caption d-none d-md-block">
      </div>
    </div>
  </div>
  <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
</div>

<nav class="navbar navbar-expand-lg navbar-light fixed-top">
  <div class="container">
    <a class="navbar-brand" href="#">SSI</a>
    <a href=""><img class="navbar-brand" src="https://i.postimg.cc/ydj6xMK5/cross.png"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto">
        
     <li class="nav-item">
    <a href="/logout" class="nav-link">Logout</a>
	    </li>
     <li class="nav-item">
    <a class="nav-link">Welcome <%=name%></a>
	    </li>
     <li class="nav-item">
    <a href="#credentials" id="credentials_link" class="nav-link" onclick="showTab('credentials')" >Credentials</a>
	    </li>
     <li class="nav-item">
    <a href="#proofs" id="proofs_link" class="nav-link" onclick="showTab('proofs')" >Proofs</a>
	    </li>
     <li class="nav-item">
    <a href="#issuing" id="issuing_link" class="nav-link" onclick="showTab('issuing')" >Issuing</a>
	    </li>
     <li class="nav-item">
    <a href="#relationships" id="relationships_link" class="nav-link" onclick="showTab('relationships')" >Relationships</a>
	    </li>
     <li class="nav-item">
    <a href="#messages" id="messages_link" class="nav-link" onclick="showTab('messages')" >Messages</a>
	    </li>
     <li class="nav-item">
	<a onclick="document.getElementById('aboutModel').style.display='block'" class="nav-link">About</a>
	    </li>
     <li class="nav-item">
</li>
  </ul>
    </div>
  </div>
</nav>
        <!--<div class="w3-container w3-card" style="position:fixed;bottom:52px;float:right; right:50px;width:300px;z-index:99;background:white;">-->
            <!--<h5>Chat with Andrew</h5>-->
            <!--<chat-window-->
                <!--id="chat"-->
                <!--author="me"-->
                <!--single-line>-->
            <!--</chat-window>-->
        <!--</div>-->
        <!--<div class="w3-container w3-card" style="position:fixed;bottom:52px;float:right; right:540px;width:300px;z-index:99;background:white;">-->
            <!--<h5>Chat with Andrew</h5>-->
            <!--<chat-window-->
                    <!--id="chat2"-->
                    <!--author="me"-->
                    <!--single-line>-->
            <!--</chat-window>-->
        <!--</div>-->

        <div class="w3-row-padding w3-center w3-margin-top">
            <% include credentials.ejs %>
            <% include proofs.ejs %>
            <% include issuing.ejs %>
            <% include relationships.ejs %>
            <% include messages.ejs %>
        </div>
        <footer style="position:fixed;bottom:0;background: black;width: 100%;">
            <p style="text-align: center;color: white;">My Endpoint DID: <%=endpointDid%></p>
        </footer>
        <script>

            function showTab(id) {
                let tabs = document.getElementsByClassName("tab");
                for (let i = 0; i < tabs.length; i++) {
                    tabs[i].style.display = "none";
                }
                document.getElementById(id).style.display = "block";

                // Bold the selected link, unbold others
                let tabLinks = document.getElementsByClassName("tab_link");
                for (i = 0; i < tabLinks.length; i++) {
                    tabLinks[i].style['font-weight'] = "normal";
                }

                document.getElementById(`${id}_link`).style['font-weight'] = "bold";
            }

            let tabs = document.getElementsByClassName("tab");
            let hashlink = document.location.hash.replace('#', '');
            let found = false;
            for(let tab of tabs) {
                if(tab.id === hashlink) {
                    showTab(hashlink);
                    found = true;
                }
            }
            if(!found) {
                window.location.href = window.location.href + "#credentials";
                showTab('relationships');
            }

            function request(url, method, message) {
                console.log(message);
                console.log(`${method}ing ${url}: ${message}`);
                let xhttp = new XMLHttpRequest();
                xhttp.open(method, url, true);
                if(message) {
                    xhttp.setRequestHeader('Content-Type', 'application/json');
                    xhttp.send(message);
                } else {
                    xhttp.send();
                }
                location.reload();
            }

            showDiv(document.getElementById('currentProofRequest').value, 'proofRequestsClass');
            function showDiv(id, className) {
                let tabs = document.getElementsByClassName(className);
                for (let i = 0; i < tabs.length; i++) {
                    tabs[i].style.display = "none";
                }
                console.log('showing div: ', id);
                document.getElementById(id).style.display = "block";
            }

            function validateProof(div, proof) {
                div.innerHTML = '<i class="fa fa-spinner fa-spin" style="font-size:100px;"></i>'
                let xhttp = new XMLHttpRequest();
                xhttp.open('POST', '/api/proofs/validate', true);
                xhttp.setRequestHeader('Content-Type', 'application/json');
                console.log(proof);
                xhttp.send(JSON.stringify(proof));
                xhttp.onload = function() {
                    console.log(xhttp);
                    if(xhttp.status === 200) {
                        console.log("Validation succeeded");
                        div.innerHTML = '<i class="fa fa-check" style="color:green;font-size:120px;"></i>'
                    } else {
                        div.innerHTML = '<i class="fa fa-times" style="color:red;font-size:120px;"></i>'
                        console.log("Validation failed");
                    }
                }
            }

        </script>
        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>

    </body>
</html>
